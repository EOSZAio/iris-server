FROM ubuntu:18.04
RUN apt update && apt install -y wget
RUN wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | sudo apt-key add -
RUN apt-add-repository 'deb https://apt.kitware.com/ubuntu/ bionic main'

RUN add-apt-repository ppa:ubuntu-toolchain-r/test

RUN apt update && \
RUN apt install -y git g++-8 cmake libssl-dev libgmp-dev zlib1g-dev
RUN update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-8 800 --slave /usr/bin/g++ g++ /usr/bin/g++-8

RUN wget https://dl.bintray.com/boostorg/release/1.67.0/source/boost_1_67_0.tar.gz
RUN tar -xvzf boost_1_67_0.tar.gz
RUN cd boost_1_67_0
RUN ./bootstrap.sh
# use " sudo ./b2 install -j N" for N CPU cores for faster compiling (may require more RAM)
RUN ./b2 install 
RUN cd ..

RUN git clone -b v1.2 --single-branch https://github.com/EOSChronicleProject/eos-chronicle.git

RUN cd eos-chronicle \
&& git submodule update --init --recursive \
&& mkdir build \
&& cd build \
&& cmake .. \
&& make

#COPY config.dev.ini /config.ini
COPY config.ini /config.ini
#Run chronicle as follows in order to create a docker container with PID 1 running chronicle in order to be ablt 
#to stop the container "docker stop" and chronicle will shutdown cleanly.
CMD ["/eos-chronicle/build/chronicle-receiver", "--config-dir=/","--data-dir=/chronicle-data"]